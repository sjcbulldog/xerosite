<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Welcome, {{ authService.currentUser()?.firstName || 'User' }}!</h1>
    <button 
      (click)="openHelpDialog()" 
      class="help-button"
      title="User Guide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
    </button>
  </header>
  
  <main class="dashboard-content">
    <div class="dashboard-card">
      <div class="dashboard-card-header-with-menu">
        <h2>FRC Teams Dashboard</h2>
        <div class="user-menu-container">
          <button (click)="toggleUserMenu()" class="user-menu-button">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
            <span class="chevron-down">‚ñº</span>
          </button>
          @if (showUserMenu()) {
            <div class="user-menu-dropdown">
              <button (click)="openProfileDialog()" class="menu-item">
                <span class="menu-icon">üë§</span>
                Edit Profile
              </button>
              <button (click)="openPreferencesDialog()" class="menu-item">
                <span class="menu-icon">‚öôÔ∏è</span>
                Preferences
              </button>
              <button (click)="openChangePasswordDialog()" class="menu-item">
                <span class="menu-icon">üîí</span>
                Change Password
              </button>
              @if (authService.currentUser()?.isSiteAdmin) {
                <button (click)="openTestMessageDialog()" class="menu-item">
                  <span class="menu-icon">üìß</span>
                  Test Message
                </button>
              }
              <button (click)="logout()" class="menu-item">
                <span class="menu-icon">üö™</span>
                Sign Out
              </button>
            </div>
          }
        </div>
      </div>
      @if (isLoadingStatistics()) {
        <p class="statistics-subtitle">Loading statistics...</p>
      } @else {
        <p class="statistics-subtitle">
          Serving {{ publicTeamsCount() + privateTeamsCount() }} Teams and {{ totalUsersCount() }} Users
        </p>
      }
      <div class="user-info">
        <h3>User Information</h3>
        <p><strong>Name:</strong> {{ authService.currentUser()?.firstName }} {{ authService.currentUser()?.lastName }}</p>
        <p><strong>Email:</strong> {{ authService.currentUser()?.primaryEmail }}</p>
        <p><strong>User Type:&nbsp;&nbsp;</strong> 
          @if (authService.currentUser()?.state === 'admin') {
            <span class="role-badge admin">Administrator</span>
          } @else if (authService.currentUser()?.state === 'active') {
            <span class="role-badge active">Active User</span>
          } @else {
            <span class="role-badge {{ authService.currentUser()?.state }}">{{ authService.currentUser()?.state | titlecase }}</span>
          }
        </p>
      </div>
    </div>

    <div class="dashboard-card">
      <div class="my-teams-header">
        <button 
          class="collapsible-header" 
          (click)="toggleMyTeams()"
          [class.active]="showMyTeams()">
          <span class="chevron">{{ showMyTeams() ? '‚ñº' : '‚ñ∂' }}</span>
          <h2>My Teams</h2>
        </button>
        <button (click)="openCreateTeamDialog()" class="create-team-button">
          <span class="plus-icon">+</span> Create Team
        </button>
      </div>
      
      @if (showMyTeams()) {
        <div class="collapsible-content">
          @if (isLoadingTeams()) {
            <p class="loading-message">Loading teams...</p>
          } @else if (teamsService.userTeams().length === 0) {
            <p class="empty-message">You haven't joined any teams yet. Create a new team to get started!</p>
          } @else {
            <div class="teams-grid">
              @for (team of teamsService.userTeams(); track team.id) {
                <div class="team-card clickable" [class.admin]="isTeamAdmin(team.id)" (click)="viewTeam(team.id)">
                  <div class="team-card-header">
                    <h3>{{ team.name }} @if (isTeamAdmin(team.id)) {<span class="admin-badge">Admin</span>}</h3>
                  </div>
                  @if (team.description) {
                    <p class="team-description">{{ team.description }}</p>
                  }
                  <div class="team-meta">
                    <span class="visibility-badge {{ team.visibility }}">{{ team.visibility | titlecase }}</span>
                    <span class="member-count">{{ team.memberCount || 0 }} member{{ (team.memberCount || 0) === 1 ? '' : 's' }}</span>
                    @if (team.pendingCount && team.pendingCount > 0) {
                      <span class="pending-count">{{ team.pendingCount }} pending</span>
                    }
                  </div>
                  @if (isAdmin()) {
                    <button 
                      class="delete-team-button"
                      (click)="openDeleteTeamDialog(team, $event)"
                      title="Delete Team">
                      üóëÔ∏è
                    </button>
                  }
                </div>
              }
            </div>
          }
        </div>
      }
    </div>

    <div class="dashboard-card">
      <button 
        class="collapsible-header" 
        (click)="togglePublicTeams()"
        [class.active]="showPublicTeams()">
        <span class="chevron">{{ showPublicTeams() ? '‚ñº' : '‚ñ∂' }}</span>
        <h2>Available Teams ({{ teamsService.publicTeams().length }})</h2>
      </button>
      
      @if (showPublicTeams()) {
        <div class="collapsible-content">
          <input 
            type="text"
            [(ngModel)]="publicTeamsSearchFilter"
            placeholder="Search teams by name, number, or description..."
            class="team-search-input"
          />
          
          @if (isLoadingPublicTeams()) {
            <p class="loading-message">Loading public teams...</p>
          } @else if (filteredPublicTeams().length === 0) {
            @if (publicTeamsSearchFilter() === '') {
              <p class="empty-message">No public teams available to join.</p>
            } @else {
              <p class="empty-message">No teams match your search.</p>
            }
          } @else {
            <div class="teams-grid">
              @for (team of filteredPublicTeams(); track team.id) {
                <div class="team-card public">
                  <div class="team-card-header">
                    <h3>{{ team.name }} <span class="team-number-badge">#{{ team.teamNumber }}</span></h3>
                  </div>
                  @if (team.description) {
                    <p class="team-description">{{ team.description }}</p>
                  }
                  <div class="team-meta">
                    <span class="member-count">{{ team.memberCount || 0 }} member{{ (team.memberCount || 0) === 1 ? '' : 's' }}</span>
                    @if (team.pendingCount && team.pendingCount > 0) {
                      <span class="pending-count">{{ team.pendingCount }} pending</span>
                    }
                  </div>
                  <button 
                    (click)="joinTeam(team.id)" 
                    class="join-button"
                    [disabled]="isJoiningTeam()">
                    {{ isJoiningTeam() ? 'Requesting...' : 'Request to Join' }}
                  </button>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>

    @if (teamsService.pendingTeams().length > 0) {
      <div class="dashboard-card">
        <button 
          class="collapsible-header" 
          (click)="togglePendingTeams()"
          [class.active]="showPendingTeams()">
          <span class="chevron">{{ showPendingTeams() ? '‚ñº' : '‚ñ∂' }}</span>
          <h2>Pending Team Requests</h2>
        </button>
        
        @if (showPendingTeams()) {
          <div class="collapsible-content">
            @if (isLoadingPendingTeams()) {
              <p class="loading-message">Loading pending requests...</p>
            } @else {
              <div class="teams-grid">
                @for (team of teamsService.pendingTeams(); track team.id) {
                  <div class="team-card pending">
                    <div class="team-card-header">
                      <h3>{{ team.name }}</h3>
                      <span class="status-badge pending">Pending Approval</span>
                    </div>
                    @if (team.description) {
                      <p class="team-description">{{ team.description }}</p>
                    }
                    <div class="team-meta">
                      <span class="member-count">{{ team.memberCount || 0 }} member{{ (team.memberCount || 0) === 1 ? '' : 's' }}</span>
                    </div>
                    <p class="pending-info">Your request to join this team is awaiting approval from a team administrator.</p>
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    }

    @if (isAdmin()) {
      <div class="dashboard-card">
        <button 
          class="collapsible-header" 
          (click)="toggleAllTeams()"
          [class.active]="showAllTeams()">
          <span class="chevron">{{ showAllTeams() ? '‚ñº' : '‚ñ∂' }}</span>
          <h2>All Teams</h2>
        </button>
        
        @if (showAllTeams()) {
          <div class="collapsible-content">
            @if (isLoadingAllTeams()) {
              <p class="loading-message">Loading all teams...</p>
            } @else if (teamsService.allTeams().length === 0) {
              <p class="empty-message">No teams exist in the system.</p>
            } @else {
              <div class="teams-grid">
                @for (team of teamsService.allTeams(); track team.id) {
                  <div class="team-card clickable" (click)="viewTeam(team.id)">
                    <div class="team-card-header">
                      <h3>{{ team.name }} <span class="team-number-badge">#{{ team.teamNumber }}</span></h3>
                    </div>
                    @if (team.description) {
                      <p class="team-description">{{ team.description }}</p>
                    }
                    <div class="team-meta">
                      <span class="visibility-badge {{ team.visibility }}">{{ team.visibility | titlecase }}</span>
                      <span class="member-count">{{ team.memberCount || 0 }} member{{ (team.memberCount || 0) === 1 ? '' : 's' }}</span>
                      @if (team.pendingCount && team.pendingCount > 0) {
                        <span class="pending-count">{{ team.pendingCount }} pending</span>
                      }
                    </div>
                    @if (getTeamAdmins(team.id).length > 0) {
                      <div class="team-admins">
                        <strong>Administrators:</strong>
                        <span class="admin-list">{{ getTeamAdmins(team.id).join(', ') }}</span>
                      </div>
                    }
                    <button 
                      class="delete-team-button"
                      (click)="openDeleteTeamDialog(team, $event)"
                      title="Delete Team">
                      üóëÔ∏è
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    }

    @if (isAdmin()) {
      <div class="dashboard-card">
        <button 
          class="collapsible-header" 
          (click)="toggleAllUsers()"
          [class.active]="showAllUsers()">
          <span class="chevron">{{ showAllUsers() ? '‚ñº' : '‚ñ∂' }}</span>
          <h2>All Users</h2>
        </button>
        
        @if (showAllUsers()) {
          <div class="collapsible-content">
            <input 
              type="text"
              [(ngModel)]="userSearchFilter"
              placeholder="Search users..."
              class="user-search-input"
            />
            
            @if (isLoadingUsers()) {
              <p class="loading-message">Loading users...</p>
            } @else if (allUsers().length === 0) {
              <p class="empty-message">No users found.</p>
            } @else {
              <div class="users-table-container">
                <table class="users-table">
                  <thead>
                    <tr>
                      <th class="sortable" (click)="sortUsers('firstName')">
                        First Name <span class="sort-icon">{{ getSortIcon('firstName') }}</span>
                      </th>
                      <th class="sortable" (click)="sortUsers('lastName')">
                        Last Name <span class="sort-icon">{{ getSortIcon('lastName') }}</span>
                      </th>
                      <th class="sortable" (click)="sortUsers('email')">
                        Email <span class="sort-icon">{{ getSortIcon('email') }}</span>
                      </th>
                      <th>State</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (user of sortedUsers(); track user.id) {
                      <tr>
                        <td>{{ user.firstName }}</td>
                        <td>{{ user.lastName }}</td>
                        <td>{{ user.primaryEmail }}</td>
                        <td>
                          @if (user.state === 'admin') {
                            <span class="role-badge admin">Administrator</span>
                          } @else if (user.state === 'active') {
                            <span class="role-badge active">Active</span>
                          } @else if (user.state === 'pending') {
                            <span class="role-badge pending">Pending</span>
                          } @else if (user.state === 'disabled') {
                            <span class="role-badge disabled">Disabled</span>
                          } @else {
                            <span class="role-badge {{ user.state }}">{{ user.state | titlecase }}</span>
                          }
                        </td>
                        <td>
                          <div class="user-actions-menu-container">
                            <button 
                              (click)="toggleUserActionsMenu(user.id, $event)" 
                              class="user-actions-button"
                              [class.active]="openUserActionsMenuId() === user.id">
                              ‚ãÆ
                            </button>
                            @if (openUserActionsMenuId() === user.id && userActionsMenuPosition()) {
                              <div class="user-actions-dropdown"
                                [style.top.px]="userActionsMenuPosition()!.top"
                                [style.left.px]="userActionsMenuPosition()!.left">
                                <button 
                                  class="menu-item"
                                  (click)="viewUserProfile(user.id)">
                                  View Profile
                                </button>
                                <button 
                                  class="menu-item"
                                  (click)="openChangeUserPasswordDialog(user)">
                                  Change Password
                                </button>
                                <button 
                                  class="menu-item delete-item"
                                  (click)="openDeleteUserDialog(user)">
                                  Delete User
                                </button>
                              </div>
                            }
                          </div>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            }
          </div>
        }
      </div>
    }
  </main>
</div>

@if (showCreateTeamDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content">
      <div class="dialog-header">
        <h2>Create New Team</h2>
        <button class="close-button" (click)="closeCreateTeamDialog()">√ó</button>
      </div>

      <form [formGroup]="createTeamForm" (ngSubmit)="onCreateTeam()" class="create-team-form">
        <div class="form-group">
          <label for="teamName">Team Name *</label>
          <input 
            id="teamName"
            type="text" 
            formControlName="name"
            [class.error]="getFieldError('name')"
            placeholder="Enter team name"
          />
          @if (getFieldError('name')) {
            <span class="error-message">{{ getFieldError('name') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="teamNumber">Team Number *</label>
          <input 
            id="teamNumber"
            type="number" 
            formControlName="teamNumber"
            [class.error]="getFieldError('teamNumber')"
            placeholder="Enter team number (1-30000)"
            min="1"
            max="30000"
          />
          @if (getFieldError('teamNumber')) {
            <span class="error-message">{{ getFieldError('teamNumber') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="teamDescription">Description</label>
          <textarea 
            id="teamDescription"
            formControlName="description"
            rows="3"
            placeholder="Describe your team's purpose"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="visibility">Visibility *</label>
          <select id="visibility" formControlName="visibility">
            <option value="private">Private - Only invited members can join</option>
            <option value="public">Public - Anyone can request to join</option>
          </select>
        </div>

        <div class="form-group">
          <label for="timezone">Timezone *</label>
          <select id="timezone" formControlName="timezone">
            @for (tz of COMMON_TIMEZONES; track tz.value) {
              <option [value]="tz.value">{{ tz.label }}</option>
            }
          </select>
          <small class="helper-text">Calendar events will be displayed in this timezone</small>
        </div>

        @if (createTeamError()) {
          <div class="alert-error">
            {{ createTeamError() }}
          </div>
        }

        <div class="dialog-actions">
          <button 
            type="button" 
            class="cancel-button"
            (click)="closeCreateTeamDialog()"
            [disabled]="isCreatingTeam()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="submit-button"
            [disabled]="createTeamForm.invalid || isCreatingTeam()">
            {{ isCreatingTeam() ? 'Creating...' : 'Create Team' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}

@if (showInvitationNotification()) {
  <div class="dialog-overlay">
    <div class="dialog-content invitation-notification">
      <div class="dialog-header">
        <h2>Team Invitations</h2>
        <button class="close-button" (click)="closeInvitationNotification()">√ó</button>
      </div>

      <div class="notification-content">
        <p class="notification-message">
          You have been invited to join the following team(s). Accept to request membership (admin approval required):
        </p>

        <div class="invitations-list">
          @for (invitation of pendingInvitations(); track invitation.id) {
            <div class="invitation-card">
              <div class="invitation-info">
                <h3>{{ invitation.teamName }}</h3>
                <p class="invitation-email">Invited to: {{ invitation.email }}</p>
                <p class="invitation-date">Sent: {{ invitation.createdAt | date:'short' }}</p>
              </div>
              <div class="invitation-actions">
                <button 
                  class="accept-button"
                  (click)="acceptInvitation(invitation.id)">
                  Accept
                </button>
                <button 
                  class="decline-button"
                  (click)="declineInvitation(invitation.id)">
                  Decline
                </button>
              </div>
            </div>
          }
        </div>

        <div class="dialog-actions">
          <button 
            class="cancel-button"
            (click)="closeInvitationNotification()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
}

@if (showChangePasswordDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content">
      <div class="dialog-header">
        <h2>Change Password</h2>
        <button class="close-button" (click)="closeChangePasswordDialog()">√ó</button>
      </div>

      <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()" class="change-password-form">
        <div class="form-group">
          <label for="currentPassword">Current Password *</label>
          <input 
            id="currentPassword"
            type="password" 
            formControlName="currentPassword"
            [class.error]="getPasswordFieldError('currentPassword')"
            placeholder="Enter your current password"
          />
          @if (getPasswordFieldError('currentPassword')) {
            <span class="error-message">{{ getPasswordFieldError('currentPassword') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="newPassword">New Password *</label>
          <input 
            id="newPassword"
            type="password" 
            formControlName="newPassword"
            [class.error]="getPasswordFieldError('newPassword')"
            placeholder="Enter your new password"
          />
          
          <div class="password-requirements">
            <p class="requirements-title">Password must contain:</p>
            <div class="requirement" [class.met]="hasMinLength()">
              <span class="requirement-icon">{{ hasMinLength() ? '‚úì' : '‚úó' }}</span>
              At least 8 characters
            </div>
            <div class="requirement" [class.met]="hasUpperCase()">
              <span class="requirement-icon">{{ hasUpperCase() ? '‚úì' : '‚úó' }}</span>
              At least one uppercase letter
            </div>
            <div class="requirement" [class.met]="hasLowerCase()">
              <span class="requirement-icon">{{ hasLowerCase() ? '‚úì' : '‚úó' }}</span>
              At least one lowercase letter
            </div>
            <div class="requirement" [class.met]="hasNumber()">
              <span class="requirement-icon">{{ hasNumber() ? '‚úì' : '‚úó' }}</span>
              At least one number
            </div>
            <div class="requirement" [class.met]="hasSymbol()">
              <span class="requirement-icon">{{ hasSymbol() ? '‚úì' : '‚úó' }}</span>
              At least one special character
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password *</label>
          <input 
            id="confirmPassword"
            type="password" 
            formControlName="confirmPassword"
            [class.error]="getPasswordFieldError('confirmPassword')"
            placeholder="Confirm your new password"
          />
          @if (getPasswordFieldError('confirmPassword')) {
            <span class="error-message">{{ getPasswordFieldError('confirmPassword') }}</span>
          }
        </div>

        @if (changePasswordError()) {
          <div class="alert-error">
            {{ changePasswordError() }}
          </div>
        }

        @if (changePasswordSuccess()) {
          <div class="alert-success">
            {{ changePasswordSuccess() }}
          </div>
        }

        <div class="dialog-actions">
          <button 
            type="button" 
            class="cancel-button"
            (click)="closeChangePasswordDialog()"
            [disabled]="isChangingPassword()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="submit-button"
            [disabled]="changePasswordForm.invalid || isChangingPassword()">
            {{ isChangingPassword() ? 'Changing...' : 'Change Password' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Preferences Dialog -->
@if (showPreferencesDialog()) {
  <app-preferences-dialog (close)="closePreferencesDialog()" />
}

<!-- Admin Change User Password Dialog -->
@if (showChangeUserPasswordDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content">
      <div class="dialog-header">
        <h2>Change Password for {{ selectedUser()?.fullName }}</h2>
        <button class="close-button" (click)="closeChangeUserPasswordDialog()">√ó</button>
      </div>

      <div class="dialog-body">
        <div class="form-group">
          <label for="newUserPassword">New Password</label>
          <input 
            id="newUserPassword"
            type="password" 
            [(ngModel)]="newUserPassword"
            placeholder="Enter new password"
            [disabled]="isChangingUserPassword()"
          />
        </div>

        <div class="form-group">
          <label for="confirmUserPassword">Confirm Password</label>
          <input 
            id="confirmUserPassword"
            type="password" 
            [(ngModel)]="confirmUserPassword"
            placeholder="Confirm new password"
            [disabled]="isChangingUserPassword()"
          />
        </div>

        <div class="password-requirements">
          <h4>Password Requirements:</h4>
          <ul>
            <li [class.met]="userPasswordHasMinLength()">
              {{ userPasswordHasMinLength() ? '‚úì' : '‚úó' }} At least 8 characters
            </li>
            <li [class.met]="userPasswordHasUpperCase()">
              {{ userPasswordHasUpperCase() ? '‚úì' : '‚úó' }} Contains uppercase letter
            </li>
            <li [class.met]="userPasswordHasLowerCase()">
              {{ userPasswordHasLowerCase() ? '‚úì' : '‚úó' }} Contains lowercase letter
            </li>
            <li [class.met]="userPasswordHasNumber()">
              {{ userPasswordHasNumber() ? '‚úì' : '‚úó' }} Contains number
            </li>
            <li [class.met]="userPasswordHasSymbol()">
              {{ userPasswordHasSymbol() ? '‚úì' : '‚úó' }} Contains special character
            </li>
          </ul>
        </div>

        @if (changeUserPasswordError()) {
          <div class="alert-error">
            {{ changeUserPasswordError() }}
          </div>
        }

        <div class="dialog-actions">
          <button 
            type="button" 
            class="cancel-button"
            (click)="closeChangeUserPasswordDialog()"
            [disabled]="isChangingUserPassword()">
            Cancel
          </button>
          <button 
            type="button" 
            class="submit-button"
            (click)="changeUserPassword()"
            [disabled]="isChangingUserPassword()">
            {{ isChangingUserPassword() ? 'Changing...' : 'Change Password' }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Delete User Confirmation Dialog -->
@if (showDeleteUserDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content delete-dialog">
      <div class="dialog-header">
        <h2>Delete User</h2>
        <button class="close-button" (click)="closeDeleteUserDialog()">√ó</button>
      </div>

      <div class="dialog-body">
        <div class="warning-message">
          <strong>‚ö†Ô∏è Warning: This action cannot be undone!</strong>
          <p>
            You are about to permanently delete the user 
            <strong>{{ userToDelete()?.fullName }}</strong> 
            ({{ userToDelete()?.primaryEmail }}).
          </p>
          <p>
            This will remove the user from the system and clear all their team 
            and subteam memberships.
          </p>
        </div>

        @if (deleteUserError()) {
          <div class="alert-error">
            {{ deleteUserError() }}
          </div>
        }

        <div class="dialog-actions">
          <button 
            type="button" 
            class="cancel-button"
            (click)="closeDeleteUserDialog()"
            [disabled]="isDeletingUser()">
            Cancel
          </button>
          <button 
            type="button" 
            class="delete-button"
            (click)="deleteUser()"
            [disabled]="isDeletingUser()">
            {{ isDeletingUser() ? 'Deleting...' : 'Delete User' }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

@if (showTestMessageDialog()) {
  <app-test-message-dialog />
}

@if (showHelpDialog()) {
  <app-help-dialog (close)="closeHelpDialog()" />
}

<!-- Delete Team Confirmation Dialog -->
@if (showDeleteTeamDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content delete-dialog">
      <div class="dialog-header">
        <h2>Delete Team</h2>
        <button class="close-button" (click)="closeDeleteTeamDialog()">√ó</button>
      </div>

      <div class="dialog-body">
        @if (deleteTeamConfirmCount() === 0) {
          <div class="warning-message">
            <strong>‚ö†Ô∏è Warning: This action cannot be undone!</strong>
            <p>
              You are about to permanently delete the team 
              <strong>{{ teamToDelete()?.name }}</strong> 
              (Team #{{ teamToDelete()?.teamNumber }}).
            </p>
            <p>
              This will remove:
            </p>
            <ul>
              <li>The team and all its settings</li>
              <li>All team member associations</li>
              <li>All subteams and their members</li>
              <li>All team events and calendar data</li>
              <li>All team messages</li>
              <li>All team media files</li>
              <li>All team links</li>
            </ul>
            <p><strong>Are you absolutely sure you want to continue?</strong></p>
          </div>
        } @else {
          <div class="warning-message critical">
            <strong>üõë FINAL CONFIRMATION</strong>
            <p>
              This is your last chance to cancel. Deleting 
              <strong>{{ teamToDelete()?.name }}</strong> 
              will permanently destroy all team data.
            </p>
            <p class="emphasis">Click "Permanently Delete Team" to confirm deletion.</p>
          </div>
        }

        @if (deleteTeamError()) {
          <div class="alert-error">
            {{ deleteTeamError() }}
          </div>
        }

        <div class="dialog-actions">
          <button 
            type="button" 
            class="cancel-button"
            (click)="closeDeleteTeamDialog()"
            [disabled]="isDeletingTeam()">
            Cancel
          </button>
          <button 
            type="button" 
            class="delete-button"
            (click)="deleteTeam()"
            [disabled]="isDeletingTeam()">
            @if (isDeletingTeam()) {
              Deleting...
            } @else if (deleteTeamConfirmCount() === 0) {
              Yes, I Want to Delete
            } @else {
              Permanently Delete Team
            }
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Profile Dialog -->
@if (showProfileDialog()) {
  <div class="dialog-overlay">
    <div class="dialog-content profile-dialog-content">
      <app-profile [isDialog]="true" (closeDialog)="closeProfileDialog()"></app-profile>
    </div>
  </div>
}
